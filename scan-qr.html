<!DOCTYPE html5>
<html lang="en">

<head>
    <title>Scan QR</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        * {
            padding: 0;
            margin: 0;
            box-sizing: border-box;
        }

        body {
            height: 100%;
            margin: 0;
        }

        .container {
            width: 100%;
            height: 100%;
            position: relative;
        }

        .reader {
            margin: 0 auto;
            width: 100%;
            height: 100%;
        }

        video {
            position: absolute;
            width: 100% !important;
            height: 100%;
            object-fit: cover;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="reader" id="reader">
            <div class="border-scan1"></div>
            <div class="border-scan2"></div>
        </div>
    </div>
</body>

<script src="js/html5-qrcode.min.js"></script>

<script>
    const html5QrCode = new Html5Qrcode("reader");
    const qrCodeSuccessCallback = (decodedText, decodedResult) => {
        scanQRCode(decodedText);
    };
    const config = { fps: 10, qrbox: 300 };

    Html5Qrcode.getCameras().then(devices => {
        if (devices && devices.length) {
            var cameraId = devices[0].id;
            if (cameraId != "") {
                html5QrCode.start(cameraId, config, qrCodeSuccessCallback);
            } else {
                console.log("No camera is found");
            }
        }
    }).catch(err => {
        console.log(err);
    });
    // html5QrCode.start({ facingMode: "user" }, config, qrCodeSuccessCallback);

    async function scanQRCode(data) {
        var body = { "data": data };
        try {
            const response = await fetch("https://patient-api-uat.miohealth.vn/QRCode/GetInfo",
                {
                    method: "POST",
                    headers: {
                        "accept": "application/json",
                        "Content-Type": "application/json-patch+json",
                    },
                    body: JSON.stringify(body),
                });
            var resultJson = await response.json();
            var result = resultJson["result"];
            console.log("result: " + JSON.stringify(result));
        } catch (e) {
            console.log(e);
        }
    }

</script>

</html>